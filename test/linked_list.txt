// see `src/StandardLibrary.cpp` for more details about LinkedListNode

function linked_list_print(node) {
    while (node != null) {
        std.print(node.value);
        node = node.get_next();

        if (node != null) {
            std.print(", ");
        }
    }

    std.println("");
}

function linked_list_size(node) {
    let result = 0;

    while (node != null) {
        result = result + 1;
        node = node.get_next();
    }

    return result;
}

function linked_list_get_node(node, index) {
    let i = 0;
    while (i < index && node != null) {
        node = node.get_next();
        i = i + 1;
    }

    return node;
}

function linked_list_get(node, index) {
    node = linked_list_get_node(node, index);

    if (node == null) {
        return null;
    }
    else {
        return node.value;
    }
}

function linked_list_set(node, index, value) {
    node = linked_list_get_node(node, index);

    if (node != null) {
        node.value = value;
    }
}

function linked_list_insert(ref node, value) {
    let new_node = std.LinkedListNode.new();
    new_node.value = value;

    if (node == null) {
        node = new_node;
        return;
    }

    let prev_node = node.get_prev();
    if (prev_node!= null) {
        prev_node.set_next(new_node);
        new_node.set_prev(prev_node);
    }

    node.set_prev(new_node);
    new_node.set_next(node);

    node = new_node;
}

function linked_list_erase(ref node) {
    if (node == null) {
        return;
    }

    let next_node = node.get_next();
    let prev_node = node.get_prev();

    if (next_node != null) {
        next_node.set_prev(prev_node);
    }
    if (prev_node != null) {
        prev_node.set_next(next_node);
    }
}

function linked_list_find(node, value, ref result_node) {
    while (node != null) {
        if (node.value == value) {
            result_node = node;
            return;
        }

        node = node.get_next();
    }

    result_node = null;
}

let test_list;

linked_list_insert(test_list, "One");
linked_list_insert(test_list, "Two");
linked_list_insert(test_list, "Three");
linked_list_insert(test_list, "Four");

linked_list_print(test_list);

function map_create(ref map, bucket_count) {
    map = std.Tuple.new("element_count", "bucket_count", "buckets");
    map.element_count = 0;
    map.bucket_count = bucket_count;
    for (let i = 0; i < bucket_count; i = i + 1) {
        linked_list_insert(map.buckets, null);
    }
}

function map_insert(ref map, key) {
     let hash = std.hash(key, map.bucket_count);
     let bucket = linked_list_get_node(map.buckets, hash).value;

     let found;
     linked_list_find(bucket, key, found);
}

let map;
map_create(map, 10);

map_insert(map, "test");

linked_list_print(map.buckets);

std.println("Enter searched string. Or 'exit'");
while(true) {
    std.print("> ");
    let input = std.readln();

    if (input == "exit") {
        break;
    }

    let result;
    linked_list_find(test_list, input, result);

    if (result != null) {
        std.println("Yes. List contains '" + result.value + "'");
    }
    else {
        std.println("Not found");
    }
}
